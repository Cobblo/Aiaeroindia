{% extends "base.html" %}
{% load static %}
{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<section class="section-content padding-y bg">
  <div class="container">
    <div class="card p-4" style="border: none; margin-bottom: 40px;">
      <div class="d-flex flex-wrap" style="gap: 3rem;">

        <!-- Product Image + Thumbnails (compact) -->
        <div style="flex: 1; min-width: 300px; max-width: 480px;">
          {% with img=product.images.all.0 %}
            {% if img %}
              <img id="mainImage"
                   src="{{ img.image.url }}"
                   alt="{{ img.alt|default:product.name }}"
                   style="width: 100%; max-height: 420px; border-radius: 10px; object-fit: contain; background: #f8f8f8; padding: 10px;">
            {% else %}
              <img id="mainImage"
                   src="{% static 'assets/img/placeholder-4x3.jpg' %}"
                   alt="{{ product.name }}"
                   style="width: 100%; max-height: 420px; border-radius: 10px; object-fit: contain; background: #f8f8f8; padding: 10px;">
            {% endif %}
          {% endwith %}

          <!-- Thumbnails -->
          <div style="display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap;">
            {% for gall in product.images.all %}
              <img src="{{ gall.image.url }}"
                   alt="{{ gall.alt|default:product.name }}"
                   onclick="switchImage(this.src)"
                   style="width: 64px; height: 64px; object-fit: cover; cursor: pointer; border-radius: 6px; border: 2px solid #ccc; background: #fff;">
            {% empty %}
              <img src="{% static 'assets/img/placeholder-4x3.jpg' %}"
                   alt="No image"
                   style="width: 64px; height: 64px; object-fit: cover; border-radius: 6px; border: 2px solid #eee; opacity:.6;">
            {% endfor %}
          </div>
        </div>

        <!-- Product Info -->
        <div style="flex: 1; min-width: 300px;">
          <h2 style="font-weight:800; line-height:1.25; margin-bottom:.5rem;">
            {{ product.name }}
          </h2>

          {% if product.sku %}
            <div style="color:#6b7280; font-size:.95rem; margin-bottom:.75rem;">SKU: {{ product.sku }}</div>
          {% endif %}

          {% if product.price %}
            <h5 class="mb-0" style="color:#002244;">
              ₹ {{ product.price|floatformat:0 }}
              <small style="color:#555; font-weight:normal;">(inclusive of all taxes)</small>
            </h5>
          {% endif %}

          {% if product.description %}
            <div class="mt-3" style="color:#374151; line-height:1.75;">
              {{ product.description|linebreaks }}
            </div>
          {% endif %}

          <!-- Add to Cart -->
          <form action="{% url 'cart:add' product.id %}" method="post" class="mt-4">
            {% csrf_token %}
            {% if product.stock|default:0 > 0 %}
              <input type="hidden" name="quantity" value="1">
              <button type="submit"
                      class="btn text-white px-4 py-2"
                      style="background-color:#002244; border-radius:8px; font-weight:700;">
                <i class="fas fa-shopping-cart text-white me-1"></i> Add to Cart
              </button>
            {% else %}
              <span class="badge bg-danger" style="font-size:1rem;">Out of Stock</span>
            {% endif %}
          </form>

          <!-- Datasheet / Downloads -->
          {% if product.attachments.all %}
            <div class="mt-4">
              <h5 style="font-weight:800; margin-bottom:.75rem;">Datasheet</h5>
              <ul class="list-unstyled" style="margin:0;">
                {% for att in product.attachments.all %}
                  <li class="d-flex align-items-center justify-content-between"
                      style="background:#f8f8f8; border-radius:10px; padding:12px 14px; margin-bottom:10px;">
                    <div class="d-flex align-items-center" style="gap:10px;">
                      <i class="bi bi-file-earmark-arrow-down" style="font-size:1.2rem;"></i>
                      <div>
                        <div style="font-weight:700; line-height:1.2;">
                          {{ att.title|default:att.filename }}
                        </div>
                        <small class="text-muted">
                          {{ att.filename }} · {{ att.file.size }} bytes
                        </small>
                      </div>
                    </div>
                    <a href="{{ att.file.url }}" download
                       class="btn btn-sm btn-outline-dark"
                       style="border-radius:8px; font-weight:700;">
                      Download
                    </a>
                  </li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}

        </div>
      </div>
    </div>
  </div>
</section>

<!-- Minimal JS to switch images -->
<script>
  function switchImage(src) {
    const main = document.getElementById('mainImage');
    if (main && src) main.src = src;
  }
</script>
{% endblock %}
